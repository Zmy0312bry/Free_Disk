# ç™½å«–æ€ªç½‘ç›˜åç«¯

## é¡¹ç›®ä»‹ç»
ç™½å«–æ€ªç½‘ç›˜æ˜¯ä¸€ä¸ªå¼€æºçš„ç½‘ç›˜ç³»ç»Ÿåç«¯é¡¹ç›®ï¼Œæ—¨åœ¨æä¾›é«˜æ•ˆã€å®‰å…¨ã€æ˜“ç”¨çš„æ–‡ä»¶å­˜å‚¨å’Œç®¡ç†æœåŠ¡ã€‚æœ¬é¡¹ç›®ä¸“æ³¨äºæ„å»ºè½»é‡çº§ä½†åŠŸèƒ½å®Œå–„çš„ç½‘ç›˜è§£å†³æ–¹æ¡ˆï¼Œé€‚åˆä¸ªäººå’Œå°å›¢é˜Ÿä½¿ç”¨ã€‚é¡¹ç›®åŸºäº Node.js å’Œ Git æŠ€æœ¯æ ˆå¼€å‘ï¼Œæ”¯æŒæ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶ã€ç¨€ç–æ£€å‡ºç­‰é«˜çº§ç‰¹æ€§ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ—‚ï¸ æ–‡ä»¶ç®¡ç†
  - æ–‡ä»¶å¤¹åˆ›å»ºå’Œç®¡ç†
  - æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
  - æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
  
- ğŸ”§ Git é›†æˆ
  - ç¨€ç–æ£€å‡ºæ”¯æŒ
  - Git LFS æ”¯æŒ
  - å®‰å…¨çš„æ¨é€æœºåˆ¶
  
- ğŸ” SSH å¯†é’¥ç®¡ç†
  - SSH å¯†é’¥ç”Ÿæˆ
  - å…¬é’¥è·å–
  
- âš™ï¸ ç³»ç»Ÿé…ç½®
  - ä»“åº“è·¯å¾„é…ç½®
  - è¿œç¨‹ä»“åº“é…ç½®
  - ç”¨æˆ·ä¿¡æ¯é…ç½®
  - ä¸‹è½½è·¯å¾„é…ç½®

## å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

- Node.js >= 14
- Git >= 2.25.0
- Git LFSï¼ˆå¯é€‰ï¼Œç”¨äºå¤§æ–‡ä»¶å­˜å‚¨ï¼‰

### å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/Free_Disk.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd Free_Disk

# å®‰è£…ä¾èµ–
npm install
```

### é…ç½®

é¡¹ç›®é¦–æ¬¡è¿è¡Œå‰éœ€è¦è¿›è¡ŒåŸºç¡€é…ç½®ï¼š

1. é…ç½®ä»“åº“è·¯å¾„
2. é…ç½®è¿œç¨‹ä»“åº“åœ°å€
3. é…ç½® Git ç”¨æˆ·ä¿¡æ¯
4. é…ç½®ä¸‹è½½è·¯å¾„

è¿™äº›é…ç½®å¯ä»¥é€šè¿‡è°ƒç”¨ç›¸åº”çš„ API æ¥å£æ¥å®Œæˆã€‚

### è¿è¡Œ

```bash
# å¼€å‘ç¯å¢ƒè¿è¡Œ
npm run dev

# ç”Ÿäº§ç¯å¢ƒè¿è¡Œ
npm start
```

æœåŠ¡å°†åœ¨ http://0.0.0.0:3001 å¯åŠ¨

### è°ƒè¯•
é¡¹ç›®æä¾›äº†`Reqable`çš„è°ƒè¯•æ¥å£jsonï¼Œè·¯å¾„åœ¨**Free-disk.reqable_collection.json**ï¼Œå¯ä»¥==ç›´æ¥==å¯¼å…¥è°ƒè¯•ï¼Œè¿™æ˜¯[ä¸‹è½½é“¾æ¥](https://reqable.com/zh-CN/)ï¼Œå¼ºçƒˆæ¨èåç«¯ä½¿ç”¨`Reqable`è°ƒè¯•ï¼

## API æ–‡æ¡£

### æ–‡ä»¶ç®¡ç†æ¥å£

#### åˆ›å»ºæ–‡ä»¶å¤¹
- **POST** `/api/file/folder`
- **åŠŸèƒ½**ï¼šåœ¨æŒ‡å®šç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶å¤¹
- **å‚æ•°**ï¼š
  ```json
  {
    "baseDir": "string",  // åŸºç¡€ç›®å½•è·¯å¾„ï¼ˆå¯é€‰ï¼‰
    "folderName": "string"  // è¦åˆ›å»ºçš„æ–‡ä»¶å¤¹åç§°ï¼ˆå¿…éœ€ï¼‰
  }
  ```
- **è¿”å›ç¤ºä¾‹**ï¼š
  ```json
  {
    "success": true,
    "path": "/path/to/new/folder"
  }
  ```

#### å¤åˆ¶æ–‡ä»¶åˆ°å®‰è£…ç›®å½•
- **POST** `/api/file/copy-to-install`
- **åŠŸèƒ½**ï¼šå°†æ–‡ä»¶ä»ä»“åº“å¤åˆ¶åˆ°å®‰è£…ç›®å½•
- **å‚æ•°**ï¼š
  ```json
  {
    "sourcePath": "string"  // æºæ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰
  }
  ```
- **è¿”å›ç¤ºä¾‹**ï¼š
  ```json
  {
    "success": true,
    "message": "æ–‡ä»¶å¤åˆ¶å®Œæˆ",
    "sourcePath": "/source/path/file.txt",
    "targetPath": "/install/path/file.txt"
  }
  ```

### Git ç›¸å…³æ¥å£

#### è·å–å·¥ä½œç©ºé—´ä¿¡æ¯
- **GET** `/api/git/workspace-info`
- **åŠŸèƒ½**ï¼šè·å– Git å·¥ä½œç©ºé—´çš„å½“å‰çŠ¶æ€
- **è¿”å›ç¤ºä¾‹**ï¼š
  ```json
  {
    "status": "clean",
    "branch": "main",
    "remote": "origin"
  }
  ```

#### ç¨€ç–æ£€å‡ºæ›´æ–°
- **POST** `/api/git/sparse-pull`
- **åŠŸèƒ½**ï¼šæ‰§è¡Œç¨€ç–æ£€å‡ºçš„æ›´æ–°æ“ä½œ
- **å‚æ•°**ï¼š
  ```json
  {
    "paths": ["path1", "path2"]  // éœ€è¦æ£€å‡ºçš„è·¯å¾„åˆ—è¡¨
  }
  ```

#### æ–‡ä»¶ä¸Šä¼ å¹¶æ¨é€
- **POST** `/api/git/upload-and-push`
- **åŠŸèƒ½**ï¼šä¸Šä¼ æ–‡ä»¶å¹¶å°†å…¶æ¨é€åˆ° Git ä»“åº“
- **å‚æ•°**ï¼š
  - `file`ï¼šæ–‡ä»¶ï¼ˆmultipart/form-dataï¼‰
  - `path`ï¼šç›®æ ‡è·¯å¾„
- **é™åˆ¶**ï¼šæ–‡ä»¶å¤§å°é™åˆ¶ä¸º 50MB

#### Git LFS åˆå§‹åŒ–
- **POST** `/api/git/lfs-update`
- **åŠŸèƒ½**ï¼šåˆå§‹åŒ–æˆ–æ›´æ–° Git LFS é…ç½®

### SSH ç®¡ç†æ¥å£

#### ç”Ÿæˆ SSH å¯†é’¥
- **POST** `/api/ssh/generate-key`
- **åŠŸèƒ½**ï¼šç”Ÿæˆæ–°çš„ SSH å¯†é’¥å¯¹

#### è·å– SSH å…¬é’¥
- **GET** `/api/ssh/get-key`
- **åŠŸèƒ½**ï¼šè·å–å½“å‰çš„ SSH å…¬é’¥

### åˆå§‹åŒ–é…ç½®æ¥å£

#### è·å–é…ç½®ä¿¡æ¯
- **GET** `/api/init/config`
- **åŠŸèƒ½**ï¼šè·å–å½“å‰ç³»ç»Ÿé…ç½®

#### æ›´æ–°ä»“åº“è·¯å¾„
- **POST** `/api/init/config/repo-path`
- **å‚æ•°**ï¼š
  ```json
  {
    "repoPath": "string"  // æ–°çš„ä»“åº“è·¯å¾„
  }
  ```

#### æ›´æ–°è¿œç¨‹ä»“åº“åœ°å€
- **POST** `/api/init/config/remote-url`
- **å‚æ•°**ï¼š
  ```json
  {
    "remoteUrl": "string"  // æ–°çš„è¿œç¨‹ä»“åº“åœ°å€
  }
  ```

#### æ›´æ–°ç”¨æˆ·é…ç½®
- **POST** `/api/init/config/user`
- **å‚æ•°**ï¼š
  ```json
  {
    "name": "string",  // Git ç”¨æˆ·å
    "email": "string"  // Git é‚®ç®±
  }
  ```

#### åˆå§‹åŒ–ä¸‹è½½è·¯å¾„
- **POST** `/api/init/config/init-install-path`
- **å‚æ•°**ï¼š
  ```json
  {
    "installPath": "string"  // ä¸‹è½½ç›®å½•è·¯å¾„
  }
  ```

## é”™è¯¯å¤„ç†

æ‰€æœ‰æ¥å£åœ¨å‘ç”Ÿé”™è¯¯æ—¶ä¼šè¿”å›ç»Ÿä¸€æ ¼å¼çš„é”™è¯¯å“åº”ï¼š

```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒæŸäº›é”™è¯¯å“åº”å¯èƒ½ä¼šåŒ…å«é¢å¤–çš„é”™è¯¯å †æ ˆä¿¡æ¯ï¼š

```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°ä¿¡æ¯",
  "error": "è¯¦ç»†é”™è¯¯å †æ ˆ"
}
```

## å‚è€ƒæ–‡çŒ®

1. [Git ç¨€ç–æ£€å‡ºå®˜æ–¹æ–‡æ¡£](https://git-scm.cn/docs/git-sparse-checkout#Documentation/git-sparse-checkout.txt-codegitsparse-checkoutsetMYDIR1SUBDIR2code)
2. [Git LFS å®˜æ–¹ç½‘ç«™](https://git-lfs.com/) - Git Large File Storage æ˜¯ä¸€ä¸ªç”¨äºç‰ˆæœ¬æ§åˆ¶å¤§æ–‡ä»¶çš„å¼€æº Git æ‰©å±•
3. [simple-git NPM åŒ…](https://www.npmjs.com/package/simple-git) - Node.js ä¸­ä½¿ç”¨ Git çš„å·¥å…·åº“


## å®é™…åº”ç”¨åœºæ™¯
æœ¬é¡¹ç›®æ˜¯é…åˆ**Free-Disk**å‰ç«¯å¼€å‘çš„`node.js`é¡¹ç›®,ä»¥ä¸‹ä¸ºå‰ç«¯è°ƒç”¨é€»è¾‘çš„è§£é‡Š
---
### ğŸ“¦ **åˆå§‹åŒ–æµç¨‹**ï¼ˆå…±4æ­¥ï¼‰
```http
POST http://<<HOST>>/init/init-repo
```
â–¸ åˆ›å»ºå¹¶é…ç½®ä»£ç ä»“åº“  
`#ä»“åº“åˆå§‹åŒ– #åŸºç¡€é…ç½®`

```http
POST http://<<HOST>>/init/init-pull
```
â–¸ è®¾ç½®è¿œç¨‹ä»“åº“åˆå§‹åŒ–æ‹‰å–  
`#è¿œç¨‹è¿æ¥ #è®¿é—®æ§åˆ¶`

```http
POST http://<<HOST>>/git/sparse-init-empty
```
â–¸ ç¨€ç–æ‹‰å–ä¼˜åŒ–å¤§ä»“åº“æ€§èƒ½  
`#æ€§èƒ½ä¼˜åŒ– #ç¨€ç–æ‹‰å–èŠ‚çœç©ºé—´`

```http
POST http://<<HOST>>/git/lfs-update
```
â–¸ é…ç½® Git LFS å¤§æ–‡ä»¶å­˜å‚¨  
`#èµ„æºç®¡ç† #ç‰ˆæœ¬æ§åˆ¶`

---

### ğŸ“¤ **æ–‡ä»¶ä¸Šä¼ æµç¨‹**ï¼ˆå…±3æ­¥ï¼‰
```http
POST http://<<HOST>>/file/folder
```
â–¸ åˆ›å»ºç›®å½•ç»“æ„  
`#è·¯å¾„ç®¡ç† #æ–‡ä»¶å¤¹æ“ä½œ`

```http
POST http://<<HOST>>/git/upload-and-push
```
â–¸ æ–‡ä»¶ä¸Šä¼ è‡³æŒ‡å®šè·¯å¾„  
`#æ•°æ®ä¼ è¾“ #å†…å®¹å­˜å‚¨`

```http
POST http://<<HOST>>/git/safe-push
```
â–¸ æœ¬åœ°ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“  
`#ç‰ˆæœ¬åŒæ­¥ #ä»£ç æäº¤`

---

### ğŸ“¥ **æ–‡ä»¶ä¸‹è½½æµç¨‹**ï¼ˆå…±2æ­¥ï¼‰
```http
POST http://<<HOST>>/init/config/init-install-path
```
â–¸ è®¾ç½®æ–‡ä»¶ä¿å­˜è·¯å¾„  
`#è·¯å¾„é…ç½® #ä¸‹è½½å‡†å¤‡`

```http
POST http://<<HOST>>/file/copy-to-install
```
â–¸ æ‰§è¡Œæ–‡ä»¶å¤åˆ¶ä¸‹è½½æ“ä½œ  
`#å†…å®¹è·å– #æ–‡ä»¶ä¼ è¾“`

---

### ğŸ”‘ **é…ç½®ç®¡ç†**ï¼ˆå…±4æ­¥ï¼‰
```http
POST http://<<HOST>>/ssh/generate-key
```
â–¸ ç”Ÿæˆè®¿é—®ä»¤ç‰Œ/SSHå¯†é’¥  
`#å®‰å…¨è®¤è¯ #å¯†é’¥ç®¡ç†`

```http
GET http://<<HOST>>/ssh/get-key
```
â–¸ è·å–å·²ç”Ÿæˆå¯†é’¥ä¿¡æ¯  
`#ä¿¡æ¯æŸ¥è¯¢ #çŠ¶æ€ç›‘æ§`

```http
POST http://<<HOST>>/init/config/remote-url
```
â–¸ æ›´æ–°è¿œç¨‹ä»“åº“url  
`#é…ç½®æ›´æ–° #åŠ¨æ€è°ƒæ•´`

```http
GET http://<<HOST>>/init/config
```
â–¸ è·å–å½“å‰é¡¹ç›®é…ç½®å‚æ•°  
`#çŠ¶æ€æŸ¥çœ‹ #é…ç½®å®¡è®¡`

### å…¶ä»–
```http
GET http://<<HOST>>/git-tree
```
â–¸ è·å–æ–‡ä»¶æ ‘ 
`#ä¾¿äºè§£æ #è·å–jsonæ ¼å¼`

```http
POST http://<<HOST>>/git/sparse-update
POST http://<<HOST>>/git/sparse-pull
```
â–¸ ç¨€ç–æ£€å‡ºé€»è¾‘ï¼Œä¸¤ä¸ªæ¥å£è¦ä¸€èµ·`å…ˆåä½¿ç”¨` 

---
> ğŸ’¡ å»ºè®®è°ƒç”¨é¡ºåºï¼šåˆå§‹åŒ– â†’ ä¸Šä¼ /ä¸‹è½½ â†’ é…ç½®ç®¡ç†ï¼Œå„æµç¨‹é—´å»ºè®®é—´éš”5ç§’ä»¥ä¸Šç¡®ä¿çŠ¶æ€åŒæ­¥
